{% extends "base.html" %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="card-title mb-0">Student Intake Form</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('intake') }}" class="needs-validation" novalidate>
                        <!-- Student Information Section -->
                        <div class="row g-3 mb-4">
                            <div class="col-12">
                                <h5 class="border-bottom pb-2">Student Information</h5>
                            </div>

                            <!-- Name -->
                            <div class="col-md-6">
                                <label for="name" class="form-label">Full Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="name" name="name" required>
                                <div class="invalid-feedback">
                                    Please provide the student's full name.
                                </div>
                            </div>

                            <!-- Age -->
                            <div class="col-md-3">
                                <label for="age" class="form-label">Age <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="age" name="age" min="16" max="100" required>
                                <div class="invalid-feedback">
                                    Please provide a valid age (16-100).
                                </div>
                            </div>

                            <!-- Gender -->
                            <div class="col-md-3">
                                <label for="gender" class="form-label">Gender <span class="text-danger">*</span></label>
                                <select class="form-select" id="gender" name="gender" required>
                                    <option value="">Choose...</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                                <div class="invalid-feedback">
                                    Please select a gender.
                                </div>
                            </div>

                            <!-- Student Index Number -->
                            <div class="col-md-6">
                                <label for="index_number" class="form-label">Student Index Number <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="index_number" name="index_number" required
                                       placeholder="e.g., 12345678">
                                <div class="invalid-feedback">
                                    Please provide the student's index number.
                                </div>
                            </div>

                            <!-- Department -->
                            <div class="col-md-6">
                                <label for="department" class="form-label">Department <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="department" name="department" required
                                       placeholder="e.g., Computer Science">
                                <div class="invalid-feedback">
                                    Please provide the department.
                                </div>
                            </div>
                            <!-- Faculty -->
                            <div class="col-md-6">
                                <label for="faculty" class="form-label">Faculty <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="faculty" name="faculty" required
                                       placeholder="e.g., Engineering">
                                <div class="invalid-feedback">
                                    Please provide the faculty.
                                </div>
                            </div>

                            <!-- Programme -->
                            <div class="col-md-6">
                                <label for="programme" class="form-label">Programme <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="programme" name="programme" required
                                       placeholder="e.g., BSc Computer Science">
                                <div class="invalid-feedback">
                                    Please provide the programme.
                                </div>
                            </div>

                            <!-- Contact Information -->
                            <div class="col-md-6">
                                <label for="contact" class="form-label">Contact Information <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="contact" name="contact" required
                                       placeholder="Phone number or email">
                                <div class="invalid-feedback">
                                    Please provide contact information.
                                </div>
                            </div>

                            <!-- Parent's Contact -->
                            <div class="col-md-6">
                                <label for="parent_contact" class="form-label">Parent's Contact (Optional)</label>
                                <input type="text" class="form-control" id="parent_contact" name="parent_contact"
                                       placeholder="Phone number or email">
                                <div class="invalid-feedback">
                                    Please provide valid contact information.
                                </div>
                            </div>

                            <!-- Hall of Residence -->
                            <div class="col-md-6">
                                <label for="hall_of_residence" class="form-label">Hall of Residence (Optional)</label>
                                <input type="text" class="form-control" id="hall_of_residence" name="hall_of_residence"
                                       placeholder="e.g., University Hall">
                                <div class="invalid-feedback">
                                    Please provide the hall of residence.
                                </div>
                            </div>
                        </div>

                        <!-- Appointment Section -->
                        <div class="row g-3 mb-4">
                            <div class="col-12">
                                <h5 class="border-bottom pb-2">Initial Appointment</h5>
                            </div>

                            <!-- Appointment Date -->
                            <div class="col-md-6">
                                <label for="appointment_date" class="form-label">Preferred Date <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="appointment_date" name="appointment_date" required
                                       min="{{ now.strftime('%Y-%m-%d') }}">
                                <div class="invalid-feedback">
                                    Please select a valid date.
                                </div>
                            </div>

                            <!-- Appointment Time -->
                            <div class="col-md-6">
                                <label for="appointment_time" class="form-label">Preferred Time <span class="text-danger">*</span></label>
                                <input type="time" class="form-control" id="appointment_time" name="appointment_time" required>
                                <div class="invalid-feedback">
                                    Please select a valid time.
                                </div>
                            </div>

                            <!-- Purpose of Visit -->
                            <div class="col-12">
                                <label for="purpose" class="form-label">Purpose of Visit <span class="text-danger">*</span></label>
                                <textarea class="form-control" id="purpose" name="purpose" rows="3" required
                                          placeholder="Please briefly describe the reason for seeking counselling..."></textarea>
                                <div class="invalid-feedback">
                                    Please provide the purpose of the visit.
                                </div>
                            </div>
                        </div>

                        <!-- Submit Buttons -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <button type="submit" class="btn btn-success">
                                    <i class="bi bi-check-circle"></i> Submit Intake Form
                                </button>
                                <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary">
                                    <i class="bi bi-x-circle"></i> Cancel
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Information Card -->
            <div class="card mt-4">
                <div class="card-header bg-info text-white">
                    <h5 class="card-title mb-0">Important Information</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info mb-0">
                        <h6 class="alert-heading"><i class="bi bi-info-circle"></i> Please Note:</h6>
                        <ul class="mb-0">
                            <li>All information provided will be kept strictly confidential.</li>
                            <li>Appointments are available Monday through Friday, 8:00 AM to 5:00 PM.</li>
                            <li>Please arrive 10 minutes before your scheduled appointment time.</li>
                            <li>If you need to reschedule, please contact the counselling office at least 24 hours in advance.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Form validation
    (function () {
        'use strict'
        var forms = document.querySelectorAll('.needs-validation')
        Array.prototype.slice.call(forms).forEach(function (form) {
            form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                    event.preventDefault()
                    event.stopPropagation()
                }
                form.classList.add('was-validated')
            }, false)
        })
    })()

    // Set minimum date for appointment to today
    document.getElementById('appointment_date').min = new Date().toISOString().split('T')[0]

    // Set default time range for appointments (8 AM to 5 PM)
    document.getElementById('appointment_time').addEventListener('change', function(e) {
        const time = e.target.value
        const hour = parseInt(time.split(':')[0])
        if (hour < 8 || hour >= 17) {
            alert('Please select a time between 8:00 AM and 5:00 PM')
            e.target.value = ''
        }
    })
</script>
{% endblock %}